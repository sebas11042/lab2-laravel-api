<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Profesores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4 text-center">Gestión de Profesores</h2>

    <!-- Formulario -->
    <form id="form-profesor" class="mb-4">
        <input type="hidden" id="profesorId">
        <div class="row g-3">
            <div class="col-md-4">
                <input type="text" id="nombre" class="form-control" placeholder="Nombre" required>
            </div>
            <div class="col-md-4">
                <input type="email" id="correo" class="form-control" placeholder="Correo" required>
            </div>
            <div class="col-md-4">
                <input type="text" id="especialidad" class="form-control" placeholder="Especialidad" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3" id="btn-submit">Agregar Profesor</button>
        <button type="button" class="btn btn-secondary mt-3 ms-2" id="btn-cancelar" style="display:none;">Cancelar edición</button>
    </form>

    <!-- Tabla -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Especialidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-profesores">
            <!-- Filas cargadas dinámicamente -->
        </tbody>
    </table>
</div>

<script>
const API_URL = "http://127.0.0.1:8000/api/profesores";

function cargarProfesores() {
    fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            const tabla = document.getElementById("tabla-profesores");
            tabla.innerHTML = "";
            data.forEach(p => {
                tabla.innerHTML += `
                    <tr>
                        <td>${p.id}</td>
                        <td>${p.nombre}</td>
                        <td>${p.correo}</td>
                        <td>${p.especialidad}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarProfesor(${p.id})">Editar</button>
                            <button class="btn btn-sm btn-danger ms-2" onclick="eliminarProfesor(${p.id})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
        });
}

document.getElementById("form-profesor").addEventListener("submit", function(e) {
    e.preventDefault();

    const profesorId = document.getElementById("profesorId").value;
    const datos = {
        nombre: document.getElementById("nombre").value,
        correo: document.getElementById("correo").value,
        especialidad: document.getElementById("especialidad").value,
    };

    const metodo = profesorId ? "PUT" : "POST";
    const url = profesorId ? `${API_URL}/${profesorId}` : API_URL;

    fetch(url, {
        method: metodo,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
    })
    .then(res => res.json())
    .then(() => {
        this.reset();
        document.getElementById("profesorId").value = "";
        document.getElementById("btn-submit").textContent = "Agregar Profesor";
        document.getElementById("btn-cancelar").style.display = "none";
        cargarProfesores();
    });
});

function editarProfesor(id) {
    fetch(`${API_URL}/${id}`)
        .then(res => res.json())
        .then(p => {
            document.getElementById("profesorId").value = p.id;
            document.getElementById("nombre").value = p.nombre;
            document.getElementById("correo").value = p.correo;
            document.getElementById("especialidad").value = p.especialidad;
            document.getElementById("btn-submit").textContent = "Actualizar Profesor";
            document.getElementById("btn-cancelar").style.display = "inline-block";
        });
}

function eliminarProfesor(id) {
    if (confirm("¿Estás seguro de eliminar este profesor?")) {
        fetch(`${API_URL}/${id}`, { method: "DELETE" })
            .then(() => cargarProfesores());
    }
}

document.getElementById("btn-cancelar").addEventListener("click", function () {
    document.getElementById("form-profesor").reset();
    document.getElementById("profesorId").value = "";
    document.getElementById("btn-submit").textContent = "Agregar Profesor";
    this.style.display = "none";
});

cargarProfesores();
</script>

</body>
</html>
