<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Aulas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4 text-center">Gestión de Aulas</h2>

    <form id="form-aula" class="mb-4">
        <input type="hidden" id="aulaId">
        <div class="row g-3">
            <div class="col-md-4">
                <input type="text" id="nombre" class="form-control" placeholder="Nombre del aula" required>
            </div>
            <div class="col-md-4">
                <input type="text" id="ubicacion" class="form-control" placeholder="Ubicación" required>
            </div>
            <div class="col-md-4">
                <input type="number" id="capacidad" class="form-control" placeholder="Capacidad" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3" id="btn-submit">Agregar Aula</button>
        <button type="button" class="btn btn-secondary mt-3 ms-2" id="btn-cancelar" style="display:none;">Cancelar edición</button>
    </form>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Ubicación</th>
                <th>Capacidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-aulas"></tbody>
    </table>
</div>

<script>
const API_URL = "http://127.0.0.1:8000/api/aulas";

function cargarAulas() {
    fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            const tabla = document.getElementById("tabla-aulas");
            tabla.innerHTML = "";
            data.forEach(a => {
                tabla.innerHTML += `
                    <tr>
                        <td>${a.id}</td>
                        <td>${a.nombre}</td>
                        <td>${a.ubicacion}</td>
                        <td>${a.capacidad}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarAula(${a.id})">Editar</button>
                            <button class="btn btn-sm btn-danger ms-2" onclick="eliminarAula(${a.id})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
        });
}

document.getElementById("form-aula").addEventListener("submit", function(e) {
    e.preventDefault();

    const id = document.getElementById("aulaId").value;
    const datos = {
        nombre: document.getElementById("nombre").value,
        ubicacion: document.getElementById("ubicacion").value,
        capacidad: document.getElementById("capacidad").value,
    };

    const metodo = id ? "PUT" : "POST";
    const url = id ? `${API_URL}/${id}` : API_URL;

    fetch(url, {
        method: metodo,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
    })
    .then(() => {
        this.reset();
        document.getElementById("aulaId").value = "";
        document.getElementById("btn-submit").textContent = "Agregar Aula";
        document.getElementById("btn-cancelar").style.display = "none";
        cargarAulas();
    });
});

function editarAula(id) {
    fetch(`${API_URL}/${id}`)
        .then(res => res.json())
        .then(a => {
            document.getElementById("aulaId").value = a.id;
            document.getElementById("nombre").value = a.nombre;
            document.getElementById("ubicacion").value = a.ubicacion;
            document.getElementById("capacidad").value = a.capacidad;
            document.getElementById("btn-submit").textContent = "Actualizar Aula";
            document.getElementById("btn-cancelar").style.display = "inline-block";
        });
}

function eliminarAula(id) {
    if (confirm("¿Eliminar esta aula?")) {
        fetch(`${API_URL}/${id}`, { method: "DELETE" }).then(() => cargarAulas());
    }
}

document.getElementById("btn-cancelar").addEventListener("click", function () {
    document.getElementById("form-aula").reset();
    document.getElementById("aulaId").value = "";
    document.getElementById("btn-submit").textContent = "Agregar Aula";
    this.style.display = "none";
});

cargarAulas();
</script>

</body>
</html>
