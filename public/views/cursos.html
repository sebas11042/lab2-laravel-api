<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Cursos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4 text-center">Gestión de Cursos</h2>

    <form id="form-curso" class="mb-4">
        <input type="hidden" id="cursoId">
        <div class="row g-3">
            <div class="col-md-4">
                <input type="text" id="nombre" class="form-control" placeholder="Nombre del curso" required>
            </div>
            <div class="col-md-4">
                <input type="text" id="codigo" class="form-control" placeholder="Código" required>
            </div>
            <div class="col-md-4">
                <input type="number" id="creditos" class="form-control" placeholder="Créditos" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3" id="btn-submit">Agregar Curso</button>
        <button type="button" class="btn btn-secondary mt-3 ms-2" id="btn-cancelar" style="display:none;">Cancelar edición</button>
    </form>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Código</th>
                <th>Créditos</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-cursos"></tbody>
    </table>
</div>

<script>
const API_URL = "http://127.0.0.1:8000/api/cursos";

function cargarCursos() {
    fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            const tabla = document.getElementById("tabla-cursos");
            tabla.innerHTML = "";
            data.forEach(c => {
                tabla.innerHTML += `
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.nombre}</td>
                        <td>${c.codigo}</td>
                        <td>${c.creditos}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarCurso(${c.id})">Editar</button>
                            <button class="btn btn-sm btn-danger ms-2" onclick="eliminarCurso(${c.id})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
        });
}

document.getElementById("form-curso").addEventListener("submit", function(e) {
    e.preventDefault();

    const id = document.getElementById("cursoId").value;
    const datos = {
        nombre: document.getElementById("nombre").value,
        codigo: document.getElementById("codigo").value,
        creditos: document.getElementById("creditos").value,
    };

    const metodo = id ? "PUT" : "POST";
    const url = id ? `${API_URL}/${id}` : API_URL;

    fetch(url, {
        method: metodo,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
    })
    .then(() => {
        this.reset();
        document.getElementById("cursoId").value = "";
        document.getElementById("btn-submit").textContent = "Agregar Curso";
        document.getElementById("btn-cancelar").style.display = "none";
        cargarCursos();
    });
});

function editarCurso(id) {
    fetch(`${API_URL}/${id}`)
        .then(res => res.json())
        .then(c => {
            document.getElementById("cursoId").value = c.id;
            document.getElementById("nombre").value = c.nombre;
            document.getElementById("codigo").value = c.codigo;
            document.getElementById("creditos").value = c.creditos;
            document.getElementById("btn-submit").textContent = "Actualizar Curso";
            document.getElementById("btn-cancelar").style.display = "inline-block";
        });
}

function eliminarCurso(id) {
    if (confirm("¿Eliminar este curso?")) {
        fetch(`${API_URL}/${id}`, { method: "DELETE" }).then(() => cargarCursos());
    }
}

document.getElementById("btn-cancelar").addEventListener("click", function () {
    document.getElementById("form-curso").reset();
    document.getElementById("cursoId").value = "";
    document.getElementById("btn-submit").textContent = "Agregar Curso";
    this.style.display = "none";
});

cargarCursos();
</script>

</body>
</html>
